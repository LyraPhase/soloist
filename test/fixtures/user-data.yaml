#cloud-config
locale: en_US.UTF-8
# grow rootfs for cloud images to make space for Ruby install
resize_rootfs: true
growpart:
  devices:
    - /dev/vda1
  mode: auto
  ignore_growroot_disabled: true
hostname: vagrant
fqdn: vagrant.internal
preserve_hostname: true
prefer_fqdn_over_hostname: true
ssh_pwauth: true
users:
- gecos: vagrant
  groups: adm,cdrom,dip,lxd,plugdev,sudo
  lock_passwd: false
  name: vagrant
  passwd: $6$rounds=4096$5CU3LEj/MQvbkfPb$LmKEF9pCfU8R.dA.GemgE/8GT6r9blge3grJvdsVTMFKyLEQwzEF3SGWqAzjawY/XHRpWj4fOiLBrRyxJhIRJ1
  shell: /bin/bash
  ssh_authorized_keys:
    - ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ==
  sudo: ["ALL=(ALL) NOPASSWD:ALL"]
package_update: true
packages:
  - foot-terminfo
runcmd:
  # Remove PasswordAuthentication=no from sshd_config
  - rm -f /etc/ssh/sshd_config.d/60-cloudimg-settings.conf
  - systemctl reload ssh.service
  - [curl, "-Ls", "http://ports.ubuntu.com/pool/universe/f/foot/foot-extra-terminfo_1.20.2-3_all.deb", "-o", "/run/cloud-init/tmp/foot-extra-terminfo_1.20.2-3_all.deb"]
  - sync /run/cloud-init/tmp/foot-extra-terminfo_1.20.2-3_all.deb
  - dpkg -i /run/cloud-init/tmp/foot-extra-terminfo_1.20.2-3_all.deb
  - rm /run/cloud-init/tmp/foot-extra-terminfo_1.20.2-3_all.deb
  - systemctl stop multipathd.service multipathd.socket apt-daily-upgrade.timer unattended-upgrades.service fwupd.service udisks2.service packagekit.service
  - systemctl disable multipathd.service multipathd.socket apt-daily-upgrade.timer unattended-upgrades.service fwupd.service udisks2.service
write_files:
  - path: /etc/modprobe.d/nfsv4-client-enable-sec-sys-idmapping.conf
    content: 'options nfs nfs4_disable_idmapping=N'
    owner: root:root
    permissions: '0o644'
    encoding: text/plain
    append: false
    defer: false
